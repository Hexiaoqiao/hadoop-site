<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at 2022-07-29
 | Rendered using Apache Maven Stylus Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Apache Hadoop Amazon Web Services support &#x2013; Object Store Auditing</title>
    <style type="text/css" media="all">
      @import url("../../css/maven-base.css");
      @import url("../../css/maven-theme.css");
      @import url("../../css/site.css");
    </style>
    <link rel="stylesheet" href="../../css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20220729" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://hadoop.apache.org/" id="bannerLeft">
                                        <img src="http://hadoop.apache.org/images/hadoop-logo.jpg" alt="" />
                </a>
                              <a href="http://www.apache.org/" id="bannerRight">
                                        <img src="http://www.apache.org/images/asf_logo_wide.png" alt="" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                   <div class="xleft">
                          <a href="http://www.apache.org/" class="externalLink">Apache</a>
        &gt;
                  <a href="http://hadoop.apache.org/" class="externalLink">Hadoop</a>
        &gt;
                  <a href="../../index.html">Apache Hadoop Amazon Web Services support</a>
        &gt;
        Object Store Auditing
        </div>
            <div class="xright">            <a href="http://wiki.apache.org/hadoop" class="externalLink">Wiki</a>
            |
                <a href="https://gitbox.apache.org/repos/asf/hadoop.git" class="externalLink">git</a>
              
                                   &nbsp;| Last Published: 2022-07-29
              &nbsp;| Version: 3.3.4
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                   <h5>General</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SingleCluster.html">Single Node Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ClusterSetup.html">Cluster Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CommandsManual.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/FileSystemShell.html">FileSystem Shell</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Compatibility.html">Compatibility Specification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DownstreamDev.html">Downstream Developer's Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/AdminCompatibilityGuide.html">Admin Compatibility Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/InterfaceClassification.html">Interface Classification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/filesystem/index.html">FileSystem Specification</a>
            </li>
          </ul>
                       <h5>Common</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CLIMiniCluster.html">CLI Mini Cluster</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/FairCallQueue.html">Fair Call Queue</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/NativeLibraries.html">Native Libraries</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Superusers.html">Proxy User</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/RackAwareness.html">Rack Awareness</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SecureMode.html">Secure Mode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ServiceLevelAuth.html">Service Level Authorization</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/HttpAuthentication.html">HTTP Authentication</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CredentialProviderAPI.html">Credential Provider API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-kms/index.html">Hadoop KMS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Tracing.html">Tracing</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellGuide.html">Unix Shell Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/registry/index.html">Registry</a>
            </li>
          </ul>
                       <h5>HDFS</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDesign.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUserGuide.html">User Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html">NameNode HA With QJM</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithNFS.html">NameNode HA With NFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ObserverNameNode.html">Observer NameNode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/Federation.html">Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFs.html">ViewFs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFsOverloadScheme.html">ViewFsOverloadScheme</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsSnapshots.html">Snapshots</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsEditsViewer.html">Edits Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsImageViewer.html">Image Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html">Permissions and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsQuotaAdminGuide.html">Quotas and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/LibHdfs.html">libhdfs (C API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/WebHDFS.html">WebHDFS (REST API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-hdfs-httpfs/index.html">HttpFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ShortCircuitLocalReads.html">Short Circuit Local Reads</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/CentralizedCacheManagement.html">Centralized Cache Management</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsNfsGateway.html">NFS Gateway</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsRollingUpgrade.html">Rolling Upgrade</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ExtendedAttributes.html">Extended Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/TransparentEncryption.html">Transparent Encryption</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html">Multihoming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ArchivalStorage.html">Storage Policies</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/MemoryStorage.html">Memory Storage Support</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/SLGUserGuide.html">Synthetic Load Generator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSErasureCoding.html">Erasure Coding</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSDiskbalancer.html">Disk Balancer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUpgradeDomain.html">Upgrade Domain</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDataNodeAdminGuide.html">DataNode Admin</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/HDFSRouterFederation.html">Router Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsProvidedStorage.html">Provided Storage</a>
            </li>
          </ul>
                       <h5>MapReduce</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html">Tutorial</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduce_Compatibility_Hadoop1_Hadoop2.html">Compatibility with 1.x</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/EncryptedShuffle.html">Encrypted Shuffle</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/PluggableShuffleAndPluggableSort.html">Pluggable Shuffle/Sort</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/DistributedCacheDeploy.html">Distributed Cache Deploy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/SharedCacheSupport.html">Support for YARN Shared Cache</a>
            </li>
          </ul>
                       <h5>MapReduce REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredAppMasterRest.html">MR Application Master</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-hs/HistoryServerRest.html">MR History Server</a>
            </li>
          </ul>
                       <h5>YARN</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YARN.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/CapacityScheduler.html">Capacity Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/FairScheduler.html">Fair Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRestart.html">ResourceManager Restart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html">ResourceManager HA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceModel.html">Resource Model</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeLabel.html">Node Labels</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeAttributes.html">Node Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebApplicationProxy.html">Web Application Proxy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html">Timeline Service V.2</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WritingYarnApplications.html">Writing YARN Applications</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnApplicationSecurity.html">YARN Application Security</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManager.html">NodeManager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/DockerContainers.html">Running Applications in Docker Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/RuncContainers.html">Running Applications in runC Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerCgroups.html">Using CGroups</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SecureContainer.html">Secure Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ReservationSystem.html">Reservation System</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html">Graceful Decommission</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/OpportunisticContainers.html">Opportunistic Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/Federation.html">YARN Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SharedCache.html">Shared Cache</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingGpus.html">Using GPU</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingFPGA.html">Using FPGA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/PlacementConstraints.html">Placement Constraints</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnUI2.html">YARN UI2</a>
            </li>
          </ul>
                       <h5>YARN REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebServicesIntro.html">Introduction</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html">Resource Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerRest.html">Node Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html#Timeline_Server_REST_API_v1">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html#Timeline_Service_v.2_REST_API">Timeline Service V.2</a>
            </li>
          </ul>
                       <h5>YARN Service</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Overview.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/QuickStart.html">QuickStart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Concepts.html">Concepts</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/YarnServiceAPI.html">Yarn Service API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/ServiceDiscovery.html">Service Discovery</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/SystemServices.html">System Services</a>
            </li>
          </ul>
                       <h5>Hadoop Compatible File Systems</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-aliyun/tools/hadoop-aliyun/index.html">Aliyun OSS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-aws/tools/hadoop-aws/index.html">Amazon S3</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure/index.html">Azure Blob Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure-datalake/index.html">Azure Data Lake Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-openstack/index.html">OpenStack Swift</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-cos/cloud-storage/index.html">Tencent COS</a>
            </li>
          </ul>
                       <h5>Auth</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-auth/index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Examples.html">Examples</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Configuration.html">Configuration</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/BuildingIt.html">Building</a>
            </li>
          </ul>
                       <h5>Tools</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-streaming/HadoopStreaming.html">Hadoop Streaming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archives/HadoopArchives.html">Hadoop Archives</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archive-logs/HadoopArchiveLogs.html">Hadoop Archive Logs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-distcp/DistCp.html">DistCp</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-gridmix/GridMix.html">GridMix</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-rumen/Rumen.html">Rumen</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-resourceestimator/ResourceEstimator.html">Resource Estimator Service</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-sls/SchedulerLoadSimulator.html">Scheduler Load Simulator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Benchmarking.html">Hadoop Benchmarking</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-dynamometer/Dynamometer.html">Dynamometer</a>
            </li>
          </ul>
                       <h5>Reference</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/release/">Changelog and Release Notes</a>
            </li>
                  <li class="none">
                  <a href="../../../api/index.html">Java API docs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellAPI.html">Unix Shell API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Metrics.html">Metrics</a>
            </li>
          </ul>
                       <h5>Configuration</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/core-default.xml">core-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/hdfs-default.xml">hdfs-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/hdfs-rbf-default.xml">hdfs-rbf-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml">mapred-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-common/yarn-default.xml">yarn-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-kms/kms-default.html">kms-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-hdfs-httpfs/httpfs-default.html">httpfs-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DeprecatedProperties.html">Deprecated Properties</a>
            </li>
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          <img alt="Built by Maven" src="../../images/logos/maven-feather.png"/>
        </a>
                       
                               </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!---
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
-->
<h1>Object Store Auditing</h1>
<p>The S3A connector provides an extension point for auditing requests to S3. The auditing can take place at the entry point to every FS operation, and inside the AWS S3 SDK, immediately before the request is executed.</p>
<p>The full architecture is covered in <a href="auditing_architecture.html">Auditing Architecture</a>; this document covers its use.</p>
<div class="section">
<h2><a name="Important:_Auditing_is_disabled_by_default"></a>Important: Auditing is disabled by default</h2>
<p>Due to a memory leak from the use of <tt>ThreadLocal</tt> fields, this auditing feature leaks memory as S3A filesystem instances are created and deleted. This causes problems in long-lived processes which either do not re-use filesystem instances, or attempt to delete all instances belonging to specific users. See <a class="externalLink" href="https://issues.apache.org/jira/browse/HADOOP-18091">HADOOP-18091</a> <i>S3A auditing leaks memory through ThreadLocal references</i>.</p>
<p>To avoid these memory leaks, auditing is disabled by default.</p>
<p>To turn auditing on, set <tt>fs.s3a.audit.enabled</tt> to <tt>true</tt>.</p></div>
<div class="section">
<h2><a name="Auditing_workflow"></a>Auditing workflow</h2>
<ol style="list-style-type: decimal">

<li>An <i>Auditor Service</i> can be instantiated for each S3A FileSystem instance, created during FS initialization and closed when the FS instance is closed.</li>
<li>The S3A FS will request from the Auditor Service an <i>Audit Span</i> for each Hadoop FileSystem API call.</li>
<li>The audit span will have callbacks invoked during each of the S3 operations invoked during the execution of the API call, <i>from within the AWS SDK</i></li>
<li>This allows the Auditor Service to log requests made and associate with users and operations.</li>
<li>And/or reject operations.</li>
<li>The bundled &#x201c;Logging Auditor&#x201d; logs operations and attaches information about calls to the HTTP Referrer header.</li>
<li>So aiding debugging of issues related to performance, bucket load, S3 costs&#x2026;etc.</li>
</ol>
<p>Thus: an Auditor Service can be plugged in to provide (best-effort) auditing as well as hinted allow/deny security.</p>
<ul>

<li>Why best effort: coverage is not complete. See limitations below.</li>
<li>Why &#x201c;hinted&#x201d; security? Any custom code running in the JVM could retrieve the AWS credential chain and so bypass this auditing mechanism.</li>
</ul></div>
<div class="section">
<h2><a name="Limitations"></a>Limitations</h2>
<p>This is not a means of controlling access to S3 resources. It is a best-effort attempt at supporting logging of FileSystem operations API calls, and, in particular, correlating S3 multiple object requests with a single FS API call, ideally even identifying the process/job generating load.</p>
<ul>

<li>Low-level code using public S3A methods intended only for internal use may not create spans.</li>
<li>Code which asks for the AWS S3 client may bypass span creation.</li>
<li>Application code can also create a new S3 client (reusing any existing credentials) and so have unaudited access to S3.</li>
<li>There&#x2019;s no tie-up with OpenTelemetry.</li>
<li>Uploads and copy operations through the TransferManager do not pick up an active span because work is executed in threads which the S3A code cannot update.</li>
<li>There&#x2019;s a limit to how long an http referer header can be; operations on long paths may be incompletely logged.</li>
</ul></div>
<div class="section">
<h2><a name="Using_Auditing"></a>Using Auditing</h2>
<p>Auditing is disabled by default. When auditing enabled, a Logging Auditor will annotate the S3 logs through a custom HTTP Referrer header in requests made to S3. Other auditor classes may be used instead.</p>
<div class="section">
<h3><a name="Auditor_Options"></a>Auditor Options</h3>
<table border="0" class="bodyTable">
<thead>

<tr class="a">
<th> Option </th>
<th> Meaning </th>
<th> Default Value </th></tr>
</thead><tbody>

<tr class="b">
<td> <tt>fs.s3a.audit.enabled</tt> </td>
<td> Is auditing enabled </td>
<td> <tt>false</tt> </td></tr>
<tr class="a">
<td> <tt>fs.s3a.audit.service.classname</tt> </td>
<td> Auditor classname </td>
<td> <tt>org.apache.hadoop.fs.s3a.audit.impl.LoggingAuditor</tt> </td></tr>
<tr class="b">
<td> <tt>fs.s3a.audit.request.handlers</tt> </td>
<td> List of extra subclasses of AWS SDK RequestHandler2 to include in handler chain </td>
<td> <tt>&quot;&quot;</tt> </td></tr>
<tr class="a">
<td> <tt>fs.s3a.audit.referrer.enabled</tt> </td>
<td> Logging auditor to publish the audit information in the HTTP Referrer header </td>
<td> <tt>true</tt> </td></tr>
<tr class="b">
<td> <tt>fs.s3a.audit.referrer.filter</tt> </td>
<td> List of audit fields to filter </td>
<td> <tt>&quot;&quot;</tt> </td></tr>
<tr class="a">
<td> <tt>fs.s3a.audit.reject.out.of.span.operations</tt> </td>
<td> Auditor to reject operations &#x201c;outside of a span&#x201d; </td>
<td> <tt>false</tt> </td></tr>
</tbody>
</table></div>
<div class="section">
<h3><a name="Disabling_Auditing."></a>Disabling Auditing.</h3>
<p>In this release of Hadoop, auditing is disabled.</p>
<p>This can be explicitly set globally or for specific buckets</p>

<div>
<div>
<pre class="source">&lt;property&gt;
  &lt;name&gt;fs.s3a.audit.enabled&lt;/name&gt;
  &lt;value&gt;false&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>

<p>Specific buckets can have auditing disabled, even when it is enabled globally.</p>

<div>
<div>
<pre class="source">&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.landsat-pds.audit.enabled&lt;/name&gt;
  &lt;value&gt;false&lt;/value&gt;
  &lt;description&gt;Do not audit landsat bucket operations&lt;/description&gt;
&lt;/property&gt;
</pre></div></div>
</div>
<div class="section">
<h3><a name="Auditing_with_the_Logging_Auditor"></a>Auditing with the Logging Auditor</h3>
<p>The &#x201c;Logging Auditor&#x201d; is the default auditor. It provides two forms of logging</p>
<ol style="list-style-type: decimal">

<li>Logging of operations in the client via the active SLF4J imolementation.</li>
<li>Dynamic generation of the HTTP Referrer header for S3 requests.</li>
</ol>
<p>The Logging Auditor is enabled by providing its classname in the option <tt>fs.s3a.audit.service.classname</tt>.</p>

<div>
<div>
<pre class="source">&lt;property&gt;
  &lt;name&gt;fs.s3a.audit.enabled&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.audit.service.classname&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.fs.s3a.audit.impl.LoggingAuditor&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>

<p>To print auditing events in the local client logs, set the associated Log4J log to log at debug:</p>

<div>
<div>
<pre class="source"># Auditing
log4j.logger.org.apache.hadoop.fs.s3a.audit.impl.LoggingAuditor=DEBUG
</pre></div></div>
</div>
<div class="section">
<h3><a name="Integration_with_S3_Server_Access_Logging"></a>Integration with S3 Server Access Logging</h3>
<p>An AWS S3 bucket can be configured to store logs of all HTTP requests made of a bucket into a different S3 bucket, <a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html">S3 Server Access Logging</a> In the logging auditor the HTTP <tt>referer</tt> field of every AWS S3 request is built up into a URL which provides context and span information. As this field is saved in the S3 logs, if S3 bucket logging is enabled, the logs will be able to correlate access by S3 clients to the actual operations taking place.</p>
<p>Note: this logging is described as &#x201c;Best Effort&#x201d;. There&#x2019;s no guarantee as to when logs arrive.</p></div>
<div class="section">
<h3><a name="Rejecting_out-of-span_operations"></a>Rejecting out-of-span operations</h3>
<p>The logging auditor can be configured to raise an exception whenever a request is made to S3 outside an audited span -that is: the thread interacting with S3 through the <tt>S3AFileSystem</tt> instance which created the auditor does not have any span activated.</p>
<p>This is primarily for development, as it can be used to guarantee spans are being entered through the public API calls.</p>

<div>
<div>
<pre class="source">&lt;property&gt;
  &lt;name&gt;fs.s3a.audit.reject.out.of.span.operations&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>

<p>This rejection process is disabled for some AWS S3 Request classes, which are created within the AWS SDK as part of larger operations and for which spans cannot be attached.</p>
<table border="0" class="bodyTable">
<thead>

<tr class="a">
<th> AWS Request Always allowed </th>
<th> Reason </th></tr>
</thead><tbody>

<tr class="b">
<td> <tt>GetBucketLocationRequest</tt> </td>
<td> Used in AWS SDK to determine S3 endpoint </td></tr>
<tr class="a">
<td> <tt>CopyPartRequest</tt> </td>
<td> Used in AWS SDK during copy operations </td></tr>
<tr class="b">
<td> <tt>CompleteMultipartUploadRequest</tt> </td>
<td> Used in AWS SDK to complete copy operations </td></tr>
</tbody>
</table>
<p>The request to initiate a copy/multipart upload is always audited, therefore the auditing process does have coverage of rename and multipart IO. However, the AWS S3 logs will not include full trace information in the referrer header of the associated copy/complete calls.</p></div></div>
<div class="section">
<h2><a name="Auditing_and_the_HTTP_Referrer_header"></a>Auditing and the HTTP Referrer header</h2>
<p>The HTTP referrer header is attached by the logging auditor. If the S3 Bucket is configured to log requests to another bucket, then these logs entries will include the audit information <i>as the referrer</i>.</p>
<p>This can be parsed (consult AWS documentation for a regular expression) and the http referrer header extracted.</p>

<div>
<div>
<pre class="source">https://audit.example.org/hadoop/1/op_rename/3c0d9b7e-2a63-43d9-a220-3c574d768ef3-3/
    ?op=op_rename
    &amp;p1=s3a://alice-london/path1
    &amp;pr=alice
    &amp;p2=s3a://alice-london/path2
    &amp;ps=235865a0-d399-4696-9978-64568db1b51c
    &amp;id=3c0d9b7e-2a63-43d9-a220-3c574d768ef3-3
    &amp;t0=12
    &amp;fs=af5943a9-b6f6-4eec-9c58-008982fc492a
    &amp;t1=12
    &amp;ts=1617116985923
</pre></div></div>

<p>Here are the fields which may be found in a request. If any of the field values were <tt>null</tt>, the field is omitted.</p>
<table border="0" class="bodyTable">
<thead>

<tr class="a">
<th> Name </th>
<th> Meaning </th>
<th> Example </th></tr>
</thead><tbody>

<tr class="b">
<td> <tt>cm</tt> </td>
<td> Command </td>
<td> <tt>S3GuardTool$BucketInfo</tt> </td></tr>
<tr class="a">
<td> <tt>fs</tt> </td>
<td> FileSystem ID </td>
<td> <tt>af5943a9-b6f6-4eec-9c58-008982fc492a</tt> </td></tr>
<tr class="b">
<td> <tt>id</tt> </td>
<td> Span ID </td>
<td> <tt>3c0d9b7e-2a63-43d9-a220-3c574d768ef3-3</tt> </td></tr>
<tr class="a">
<td> <tt>ji</tt> </td>
<td> Job ID </td>
<td> <tt>(Generated by query engine)</tt> </td></tr>
<tr class="b">
<td> <tt>op</tt> </td>
<td> Filesystem API call </td>
<td> <tt>op_rename</tt> </td></tr>
<tr class="a">
<td> <tt>p1</tt> </td>
<td> Path 1 of operation </td>
<td> <tt>s3a://alice-london/path1</tt> </td></tr>
<tr class="b">
<td> <tt>p2</tt> </td>
<td> Path 2 of operation </td>
<td> <tt>s3a://alice-london/path2</tt> </td></tr>
<tr class="a">
<td> <tt>pr</tt> </td>
<td> Principal </td>
<td> <tt>alice</tt> </td></tr>
<tr class="b">
<td> <tt>ps</tt> </td>
<td> Unique process UUID </td>
<td> <tt>235865a0-d399-4696-9978-64568db1b51c</tt> </td></tr>
<tr class="a">
<td> <tt>t0</tt> </td>
<td> Thread 0: thread span was created in </td>
<td> <tt>100</tt> </td></tr>
<tr class="b">
<td> <tt>t1</tt> </td>
<td> Thread 1: thread this operation was executed in </td>
<td> <tt>200</tt> </td></tr>
<tr class="a">
<td> <tt>ts</tt> </td>
<td> Timestamp (UTC epoch millis) </td>
<td> <tt>1617116985923</tt> </td></tr>
</tbody>
</table>
<p>Thread IDs are from the current thread in the JVM.</p>

<div>
<div>
<pre class="source">Long.toString(Thread.currentThread().getId())
</pre></div></div>

<p>When <tt>t0</tt> and <tt>t1</tt> are different it means that the span has been handed off to another thread for work on behalf of the original operation. This can be correlated with log entries on the client to isolate work to specific threads.</p>
<div class="section">
<h3><a name="Limitations_of_the_HTTP_Referrer_header"></a>Limitations of the HTTP Referrer header</h3>
<p>There is a size limit on the length of the header; operations on long paths may exceed it. In such situations the audit log is incomplete.</p>
<p>This is why the span ID is always passed in as part of the URL, rather than just an HTTP query parameter: even if the header is chopped, the span ID will always be present.</p></div></div>
<div class="section">
<h2><a name="Privacy_Implications_of_HTTP_Referrer_auditing"></a>Privacy Implications of HTTP Referrer auditing</h2>
<p>When the S3A client makes requests of an S3 bucket, the auditor adds span information to the header, which is then stored in the logs</p>
<p>If the S3 bucket is owned by the same organization as the client, this span information is internal to the organization.</p>
<p>If the S3 bucket is owned/managed by a different entity, then the span information is visible in any S3 bucket logs collected by that entity. This includes the principal name and the command executed if the application is launched via the <tt>Tools</tt> or service launcher APIs.</p>
<p>Sharing this information can be disabled by either filtering specific headers, or by explicitly disabling referrer header generation entirely.</p>
<p>Note: even when the HTTP Referrer is disabled by or the principal filtered, AWS S3 logs include ARN of the user or IAM role making the request.</p>
<div class="section">
<h3><a name="Filtering_Referrer_headers"></a>Filtering Referrer headers</h3>
<p>Specific fields can be filtered from the referrer header, and so are not included in the S3A logs.</p>

<div>
<div>
<pre class="source">&lt;property&gt;
  &lt;name&gt;fs.s3a.audit.referrer.filter&lt;/name&gt;
  &lt;value&gt;pr, cm&lt;/value&gt;
  &lt;description&gt;Strip out principal and command from referrer headers&lt;/description&gt;
&lt;/property&gt;
</pre></div></div>
</div>
<div class="section">
<h3><a name="Disabling_Referrer_headers"></a>Disabling Referrer headers</h3>
<p>The logging auditor can be configured to not add the referrer header by setting the option <tt>fs.s3a.audit.referrer.enabled</tt> to <tt>false</tt>, either globally or for specific buckets:</p>

<div>
<div>
<pre class="source">&lt;property&gt;
  &lt;name&gt;fs.s3a.audit.referrer.enabled&lt;/name&gt;
  &lt;value&gt;false&lt;/value&gt;
  &lt;description&gt;Disable referrer for all buckets&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.landsat-pds.audit.referrer.enabled&lt;/name&gt;
  &lt;value&gt;false&lt;/value&gt;
  &lt;description&gt;Do not add the referrer header to landsat operations&lt;/description&gt;
&lt;/property&gt;
</pre></div></div>
</div></div>
<div class="section">
<h2><a name="Collecting_AWS_S3_Logs_for_Analysis"></a>Collecting AWS S3 Logs for Analysis</h2>
<p>The S3 Bucket(s) must be set up for <a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html">Server Access Logging</a>.</p>
<p>This will tell AWS S3 to collect access logs of all HTTP requests and store them in a different bucket in the same region. The logs arrive as files containing a few seconds worth of log data, stored under the configured path.</p>
<div class="section">
<h3><a name="Enabling_logging:_Source_bucket"></a>Enabling logging: Source bucket</h3>
<ol style="list-style-type: decimal">

<li>Create a separate bucket for logs in the same region, if you do not already have one.</li>
<li>In the S3 console, locate the bucket you wish to act as a source for logs, and go to the &#x201c;properties&#x201d;.</li>
<li>Scroll down to &#x201c;Server access logging&#x201d;</li>
<li>Select &#x201c;edit&#x201d; and then enable logging, entering a path in a nearby bucket for logs. (Tip: for ease of logging multiple buckets to the same log bucket, use a prefix like <tt>logs/$BUCKET/log-</tt> to isolate different bucket&#x2019;s logs. For example, the path log data from <tt>dev data london</tt> could be <tt>s3://london-log-bucket/logs/dev-data-lon/log-</tt></li>
<li>Save this.</li>
</ol>
<p>There&#x2019;s a lag of about an hour between S3 requests being made and the logs appearing; don&#x2019;t worry during setup if things do not appear to be working. Enable the log, work with the bucket through the &#x201c;hadoop fs&#x201d; command line, wait an hour, then go and look in the log bucket for the entries. The log filename includes the time at which these logs began</p></div>
<div class="section">
<h3><a name="Keeping_costs_down_by_deleting_old_logs."></a>Keeping costs down by deleting old logs.</h3>
<p>As logs are stored in an S3 bucket, they too run up charges. Keep costs down by deleting logs after a period of time, and/or set up a workflow to load and coalesce log entries into a compressed format and larger files.</p>
<p>It is straightforward to set up a rule to automatically delete old log files.</p>
<ol style="list-style-type: decimal">

<li>In the S3 console, bring up the bucket which is the destination for the logs, e.g. <tt>london-log-bucket</tt>.</li>
<li>Go to the &#x201c;Management&#x201d; tab.</li>
<li>Add a lifecycle rule (alongside the &#x201c;abort pending uploads&#x201d; rule you should already have).</li>
<li>Add rule name &#x201c;Delete old log files&#x201d;.</li>
<li>Select &#x201c;Limit the scope&#x201d;.</li>
<li>Add the prefix <tt>logs/</tt> to have it delete all logs of all buckets. Important: you <i>must not</i> have any leading &#x201c;/&#x201d;, such as <tt>/logs/</tt> -there will be no match and the rule will not work.</li>
<li>In &#x201c;Lifecycle rule actions&#x201d;, select &#x201c;Expire current versions&#x201d; This will delete log entries.</li>
<li>In &#x201c;Expire current versions of objects&#x201d;, set the number of days to keep log entries.</li>
<li>Finish by pressing the &#x201c;Create Rule&#x201d; button</li>
</ol>
<p>Keep an eye on the bucket to make sure the deletion is working; it&#x2019;s easy to make an error in the prefix, and as logs will be created without limit, costs will ramp up.</p></div></div>
<div class="section">
<h2><a name="Parsing_AWS_S3_Logs_to_extract_the_referrer_header"></a>Parsing AWS S3 Logs to extract the referrer header</h2>
<p>The <a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/LogFormat.html">AWS S3 Documentation</a> covers the log format and includes a hive external table declaration to work with it.</p>
<p>The Java pattern regular expression used in the <tt>hadoop-aws</tt> test suites to extract headers is defined as:</p>

<div>
<div>
<pre class="source">(?&lt;owner&gt;[^ ]*) (?&lt;bucket&gt;[^ ]*) (?&lt;timestamp&gt;\[(.*?)\]) (?&lt;remoteip&gt;[^ ]*) (?&lt;requester&gt;[^ ]*) (?&lt;requestid&gt;[^ ]*) (?&lt;operation&gt;[^ ]*) (?&lt;key&gt;[^ ]*) (?&lt;requesturi&gt;(-|&quot;[^&quot;]*&quot;)) (?&lt;http&gt;(-|[0-9]*)) (?&lt;awserrorcode&gt;[^ ]*) (?&lt;bytessent&gt;[^ ]*) (?&lt;objectsize&gt;[^ ]*) (?&lt;totaltime&gt;[^ ]*) (?&lt;turnaroundtime&gt;[^ ]*) (?&lt;referrer&gt;(-|&quot;[^&quot;]*&quot;)) (?&lt;useragent&gt;(-|&quot;[^&quot;]*&quot;)) (?&lt;version&gt;[^ ]*) (?&lt;hostid&gt;[^ ]*) (?&lt;sigv&gt;[^ ]*) (?&lt;cypher&gt;[^ ]*) (?&lt;auth&gt;[^ ]*) (?&lt;endpoint&gt;[^ ]*) (?&lt;tls&gt;[^ ]*)*$
</pre></div></div>

<p>The class <tt>org.apache.hadoop.fs.s3a.audit.S3LogParser</tt> provides this pattern as well as constants for each group. It is declared as <tt>Public/Unstable</tt>.</p></div>
<div class="section">
<h2><a name="Debugging"></a>Debugging</h2>
<p>The <tt>org.apache.hadoop.fs.s3a.audit</tt> log context contains logs for the different components implementing auditing.</p>
<p>Logging of requests audited with the <tt>LoggingAuditService</tt> can be enabled by setting that log to debug.</p>

<div>
<div>
<pre class="source"># Log before a request is made to S3
log4j.logger.org.apache.hadoop.fs.s3a.audit.impl.LoggingAuditor=DEBUG
</pre></div></div>

<p>This adds one log line per request -and does provide some insight into communications between the S3A client and AWS S3.</p>
<p>For low-level debugging of the Auditing system, such as when when spans are entered and exited, set the log to <tt>TRACE</tt>:</p>

<div>
<div>
<pre class="source"># log request creation, span lifecycle and other low-level details
log4j.logger.org.apache.hadoop.fs.s3a.audit=TRACE
</pre></div></div>

<p>This is very noisy and not recommended in normal operation.</p></div>
<div class="section">
<h2><a name="Integration_with_S3A_Committers"></a>Integration with S3A Committers</h2>
<p>Work submitted through the S3A committer will have the job (query) ID associated with S3 operations taking place against all S3A filesystems in that thread.</p>
<p>For this to be useful, the work performed in a task MUST be in the same thread which called <tt>jobSetup()</tt> or <tt>taskSetup()</tt> on the committer.</p></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        &#169;            2008-2022
              Apache Software Foundation
            
                          - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a>.
        Apache Maven, Maven, Apache, the Apache feather logo, and the Apache Maven project logos are trademarks of The Apache Software Foundation.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
